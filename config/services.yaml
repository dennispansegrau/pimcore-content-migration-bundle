services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

    PimcoreContentMigration\:
        resource: '../src/*'

    PimcoreContentMigration\Command\:
        resource: '../src/Command/*'
        tags: ['console.command']

    PimcoreContentMigration\Generator\CodeGenerator:
        arguments:
            $templates: '%pimcore_content_migration.templates%'

    PimcoreContentMigration\Factory\SettingsFactory:
        arguments:
            $defaultNamespace: '%pimcore_content_migration.default_namespace%'

    PimcoreContentMigration\Builder\:
        resource: '../src/Builder/*'
        public: true

    PimcoreContentMigration\Writer\NamespaceResolver:
        arguments:
            $dependencyFactory: '@doctrine.migrations.dependency_factory'

    PimcoreContentMigration\Twig\Extension\InstanceOfTwigTest:
        tags: [ 'twig.extension' ]

    PimcoreContentMigration\Converter\Stringifier\ValueToStringConverter:
        public: true
        arguments:
            $handlers: !tagged_iterator 'pcmb.stringifier_handler'
        tags:
            - { name: 'pcmb.stringifier_converter', priority: 0 }

    # Autowire remaining handlers
    PimcoreContentMigration\Converter\Stringifier\Handler\:
        resource: '../src/Converter/Stringifier/Handler/*'
        exclude:
            - '../src/Converter/Stringifier/Handler/DefaultScalarStringifier.php'
            - '../src/Converter/Stringifier/Handler/NewExpressionStringifier.php'
        autowire: true
        autoconfigure: false
        tags:
            - { name: 'pcmb.stringifier_handler', priority: 0 }

    # Default handler (must be last)
    PimcoreContentMigration\Converter\Stringifier\Handler\DefaultScalarStringifier:
        tags:
            - { name: 'pcmb.stringifier_handler', priority: -10000 }

    # Special case handler (high priority)
    PimcoreContentMigration\Converter\Stringifier\Handler\NewExpressionStringifier:
        tags:
            - { name: 'pcmb.stringifier_handler', priority: 1000 }
